<!DOCTYPE html>
<html lang="es" xmlns:th="http://www.thymeleaf.org">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title th:text="${mascota.id != null} ? 'Editar Mascota' : 'Nueva Mascota'">PetCare</title>
    <link rel="stylesheet" href="/styles.css">
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap"
        rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
</head>

<body>
    <div class="app-container">
        <aside class="sidebar">
            <div class="sidebar-header">
                <div class="logo">
                    <i class="fas fa-paw"></i>
                    <h1>PetCare</h1>
                </div>
                <p>Sistema de gestión de Mascotas</p>
            </div>
            <nav class="sidebar-nav">
                <a th:href="@{/mascotas}" class="nav-item">
                    <i class="fas fa-home"></i>
                    <span>Inicio</span>
                </a>
                <a th:href="@{/mascotas/nueva}" class="nav-item active">
                    <i class="fas fa-plus-circle"></i>
                    <span>Agregar mascota</span>
                </a>
                <a th:href="@{/mascotas}" class="nav-item">
                    <i class="fas fa-list"></i>
                    <span>Lista de mascotas</span>
                </a>
                <a th:href="@{/vaccine}" class="nav-item">
                    <i class="fas fa-syringe"></i>
                    <span>Vacunas</span>
                </a>
                <a href="#" class="nav-item">
                    <i class="fas fa-calendar-alt"></i>
                    <span>Citas</span>
                </a>
                <a th:href="@{/api/logout}" class="nav-item">
                    <i class="fas fa-sign-out-alt"></i>
                    <span>Cerrar sesión</span>
                </a>
            </nav>
            <div class="sidebar-footer">
                <div class="user-profile">
                    <img src="https://ui-avatars.com/api/?name=Usuario&background=0083b0&color=fff" alt="Usuario">
                    <div class="user-info">
                        <strong th:text="${session.name}">Usuario</strong>
                        <small>Administrador</small>
                    </div>
                </div>
            </div>
        </aside>

        <main class="main-content">
            <header class="main-header">
                <div class="header-title">
                    <h2 th:text="${mascota.id != null} ? 'Editar Mascota' : 'Nueva Mascota'"></h2>
                    <p>Complete el formulario para registrar una nueva mascota</p>
                </div>
                <div class="header-actions">
                    <a th:href="@{/mascotas}" class="btn btn-back">
                        <i class="fas fa-arrow-left"></i> Volver
                    </a>
                </div>
            </header>

            <div class="content-wrapper">
                <div th:if="${error}" class="alert alert-error">
                    <i class="fas fa-exclamation-circle"></i>
                    <span th:text="${error}"></span>
                </div>

                <form th:action="${mascota.id != null} ? @{/mascotas/actualizar/{id}(id=${mascota.id})} : @{/mascotas}"
                    method="post" class="pet-form">
                    <input type="hidden" th:if="${mascota.id != null}" th:value="${mascota.id}" name="id">

                    <div class="form-section">
                        <h3><i class="fas fa-info-circle"></i> Información Básica</h3>
                        <div class="form-row">
                            <div class="form-group">
                                <label for="nombre">Nombre *</label>
                                <input type="text" id="nombre" name="nombre" th:value="${mascota.nombre}" required>
                            </div>
                            <div class="form-group">
                                <label for="tipoAnimal">Tipo de Animal *</label>
                                <select id="tipoAnimal" name="tipoAnimal" required
                                    onchange="showSpecificFields(this.value)">
                                    <option value="">Seleccione un tipo</option>
                                    <option th:each="tipo : ${tiposAnimal}" th:value="${tipo}"
                                        th:text="${tipo.displayName}"
                                        th:selected="${mascota.tipoAnimal != null && mascota.tipoAnimal == tipo}">
                                    </option>
                                </select>
                            </div>
                        </div>

                        <div class="form-row">
                            <div class="form-group">
                                <label for="fechaNacimiento">Fecha de Nacimiento</label>
                                <input type="date" id="fechaNacimiento" name="fechaNacimiento"
                                    th:value="${mascota.fechaNacimiento}">
                            </div>
                            <div class="form-group">
                                <label for="peso">Peso (kg)</label>
                                <input type="number" step="0.1" id="peso" name="peso" th:value="${mascota.peso}"
                                    min="0.1" max="100">
                            </div>
                        </div>

                        <div class="form-row">
                            <div class="form-group">
                                <label for="color">Color</label>
                                <input type="text" id="color" name="color" th:value="${mascota.color}">
                            </div>
                            <div class="form-group">
                                <label for="sexo">Sexo</label>
                                <select id="sexo" name="sexo">
                                    <option value="">Seleccionar</option>
                                    <option value="Macho" th:selected="${mascota.sexo == 'Macho'}">Macho</option>
                                    <option value="Hembra" th:selected="${mascota.sexo == 'Hembra'}">Hembra</option>
                                </select>
                            </div>
                        </div>
                    </div>

                    <div class="form-section">
                        <h3><i class="fas fa-notes-medical"></i> Información de Salud</h3>
                        <div class="form-row">
                            <div class="form-group">
                                <label for="esterilizado">Esterilizado</label>
                                <select id="esterilizado" name="esterilizado">
                                    <option value="false" th:selected="${!mascota.esterilizado}">No</option>
                                    <option value="true" th:selected="${mascota.esterilizado}">Sí</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label for="ultimaDesparasitacion">Última Desparasitación</label>
                                <input type="date" id="ultimaDesparasitacion" name="ultimaDesparasitacion"
                                    th:value="${mascota.ultimaDesparasitacion}">
                            </div>
                        </div>

                        <div class="form-group">
                            <label for="dieta">Dieta/Alimentación</label>
                            <textarea id="dieta" name="dieta" rows="2" th:text="${mascota.dieta}"></textarea>
                        </div>

                        <div class="form-group">
                            <label for="notas">Notas Adicionales</label>
                            <textarea id="notas" name="notas" rows="3" th:text="${mascota.notas}"></textarea>
                        </div>
                    </div>

                    <!-- Campos específicos por tipo de animal -->
                    <div id="dogFields" class="specific-fields" style="display: none;">
                        <h3><i class="fas fa-dog"></i> Información para Perros</h3>
                        <div class="form-row">
                            <div class="form-group">
                                <label for="raza">Raza</label>
                                <input type="text" id="raza" name="raza" th:value="${mascota.raza}">
                            </div>
                            <div class="form-group">
                                <label for="tamano">Tamaño</label>
                                <select id="tamano" name="tamano">
                                    <option value="">Seleccionar</option>
                                    <option value="Pequeño" th:selected="${mascota.tamano == 'Pequeño'}">Pequeño</option>
                                    <option value="Mediano" th:selected="${mascota.tamano == 'Mediano'}">Mediano</option>
                                    <option value="Grande" th:selected="${mascota.tamano == 'Grande'}">Grande</option>
                                </select>
                            </div>
                        </div>
                        <div class="form-row">
                            <div class="form-group">
                                <label for="tipoPelaje">Tipo de Pelaje</label>
                                <input type="text" id="tipoPelaje" name="tipoPelaje" th:value="${mascota.tipoPelaje}">
                            </div>
                            <div class="form-group">
                                <label for="pedigree">Pedigree</label>
                                <select id="pedigree" name="pedigree">
                                    <option value="false" th:selected="${!mascota.pedigree}">No</option>
                                    <option value="true" th:selected="${mascota.pedigree}">Sí</option>
                                </select>
                            </div>
                        </div>
                    </div>

                    <!-- Repite para otros tipos de animales (gatos, aves, etc.) -->
                    <!-- ... -->

                    <div class="form-actions">
                        <button type="submit" class="btn btn-primary">
                            <i class="fas fa-save"></i> Guardar
                        </button>
                        <a th:href="@{/mascotas}" class="btn btn-secondary">
                            <i class="fas fa-times"></i> Cancelar
                        </a>
                    </div>
                </form>
            </div>
        </main>
    </div>

    <script>
        function showSpecificFields(animalType) {
            // Oculta todos los campos específicos primero
            document.querySelectorAll('.specific-fields').forEach(el => {
                el.style.display = 'none';
            });

            // Muestra los campos correspondientes al tipo seleccionado
            if (animalType === 'DOG') {
                document.getElementById('dogFields').style.display = 'block';
            }
            // Agrega lógica para otros tipos de animales
            // else if (animalType === 'CAT') { ... }
        }

        // Mostrar campos específicos si ya hay un tipo seleccionado (en edición)
        document.addEventListener('DOMContentLoaded', function() {
            const tipoAnimal = document.getElementById('tipoAnimal').value;
            if (tipoAnimal) {
                showSpecificFields(tipoAnimal);
            }
        });
    </script>
</body>

</html>